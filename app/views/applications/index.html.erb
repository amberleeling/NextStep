<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>
  <div class="container">
    <%= render 'shared/navbar' %>

    <h2 style="font-size: 22px; font-weight: 600; margin-top: 24px; margin-bottom: 24px;">Applications</h2>

    <% if @applications.any? %>
      <% @applications.each do |application| %>
        <div class="application-card" id="application-<%= application.id %>" style="position: relative; margin-bottom: 20px; padding: 15px; border: 1px solid #eee; border-radius: 8px;">

          <!-- 編輯與刪除 icon -->
          <div class="card-actions">
            <a href="javascript:void(0);" class="edit-toggle" data-id="<%= application.id %>">
              <i class="fas fa-pen"></i>
            </a>
            <%= link_to application_path(application), method: :delete, data: { confirm: "Are you sure?" }, class: "delete-icon" do %>
              <i class="fas fa-trash"></i>
            <% end %>
          </div>

          <!-- 顯示內容 -->
          <div class="display-mode" id="display-<%= application.id %>">
            <h3><%= application.job.position %></h3>
            <p style="color: #666;"><%= application.job.company %></p>
            <p style="color: #888; font-size: 14px;">
              Status: <strong><%= application.status.capitalize %></strong> |
              Applied on: <%= application.date.strftime("%Y-%m-%d") %>
            </p>
          </div>

          <!-- 編輯表單（預設隱藏） -->
          <div class="edit-form" id="form-<%= application.id %>" style="display: none;">
            <%= form_with model: application, local: true do |f| %>
              <div style="margin-top: 10px;">
                <%= f.label :position %><br>
                <%= f.text_field :position, value: application.job.position %>
              </div>

              <div>
                <%= f.label :description %><br>
                <%= f.text_area :description, value: application.job.description %>
              </div>

              <div>
                <%= f.label :status %><br>
                <%= f.select :status, ['pending', 'accepted', 'rejected'], selected: application.status %>
              </div>

              <%= f.submit "Save", style: "margin-top: 8px;" %>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

  <%= yield %>
  <%= render 'shared/tabbar' %>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    const editButtons = document.querySelectorAll(".edit-toggle");

    editButtons.forEach(button => {
      button.addEventListener("click", () => {
        const id = button.dataset.id;
        const form = document.getElementById(`form-${id}`);
        const display = document.getElementById(`display-${id}`);

        // 切換顯示/隱藏
        form.style.display = form.style.display === "none" ? "block" : "none";
        display.style.display = display.style.display === "none" ? "block" : "none";
      });
    });
  });
</script>
</body>


<style>
  .container {
    padding: 20px;
    max-width: 600px;
    margin: 0 auto;
  }
  .card-actions {
  position: absolute;
  top: 12px;
  right: 12px;
  display: flex;
  gap: 10px;
}

.edit-icon i,
.delete-icon i {
  font-size: 14px;
  color: #999;
  cursor: pointer;
}

.edit-icon:hover i {
  color: #007bff;
}

.delete-icon:hover i {
  color: #ff4d4f;
}

</style>
